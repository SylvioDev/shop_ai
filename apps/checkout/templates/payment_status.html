{% extends "checkout_base.html" %}
{% block title %} Payment status {% endblock title%}
{% block content %} 
    <br>
    <br>
    <br>
    <br>

<!-- Payment Status Content -->
    <div class="payment-container col-lg-6 ">
    
        {% if order_status == 'paid' %}
            <!-- Success Status -->
            <div id="successStatus" class="status-card">
                <div class="icon-container success-icon">
                    <i class="bi bi-check-lg checkmark"></i>
                </div>

                <h1 class="status-title success-text">Payment Successful!</h1>
                <p class="status-message">Your payment has been processed successfully. A confirmation email has been sent to your registered email address.</p>
                
                <div class="transaction-details">
                    <div class="detail-row">
                        <span class="detail-label">Transaction ID:</span>
                        <span class="detail-value" id="transactionId">{{ payment.transaction_id }}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Amount Paid:</span>
                        <span class="detail-value" id="amount">${{ payment.amount|floatformat:2 }}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Payment Method:</span>
                        <span class="detail-value" id="paymentMethod">{{ payment.method }}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Date & Time:</span>
                        <span class="detail-value" id="dateTime">{{ payment.paied_at }}</span>
                    </div>
                </div>

                <button class="btn btn-custom btn-success-custom" >
                    <i class="bi bi-receipt me-2"></i>
                    <a href="{% url 'process-receipt' order.order_number %}" class="text-white text-decoration-none">
                        View Receipt
                    </a>
                </button>
                <button class="btn btn-custom btn-outline-custom" onclick="goToHome()">
                    <i class="bi bi-house me-2"></i>Go to Home
                </button>
            </div>

        {% elif status == 'error' %} 
        
            <!-- Failed Status -->
            <div id="failedStatus" class="status-card">
                <div class="icon-container failed-icon">
                    <i class="bi bi-x-lg cross"></i>
                </div>
                <h1 class="status-title failed-text">Payment Failed!</h1>
                <p class="status-message">Unfortunately, your payment could not be processed. Please check your payment details and try again.</p>
                
                <div class="transaction-details">
                    <div class="detail-row">
                        <span class="detail-label">Reference ID:</span>
                        <span class="detail-value" id="failedRefId">{{ transaction_id }}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Reason:</span>
                        <span class="detail-value" id="failedReason">{{ failure_reason }}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Attempted Amount:</span>
                        <span class="detail-value" id="failedAmount">${{ amount_paid }}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Date & Time:</span>
                        <span class="detail-value" id="failedDateTime">{{ payment_date }}</span>
                    </div>
                </div>

                <button class="btn btn-custom btn-danger-custom" onclick="retryPayment()">
                    <i class="bi bi-arrow-clockwise me-2"></i><a class="text-white text-decoration-none" href="{% url 'home' %}">Retry Payment</a>
                </button>
                <button class="btn btn-custom btn-outline-custom" onclick="contactSupport()">
                    <i class="bi bi-headset me-2"></i>Contact Support
                </button>
            </div>

        
        {% else %}
            
        {% endif %}

    
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Show status based on URL parameter or manual selection
        function showStatus(status) {
            const successDiv = document.getElementById('successStatus');
            const failedDiv = document.getElementById('failedStatus');
            
            if (status === 'success') {
                successDiv.style.display = 'block';
                failedDiv.style.display = 'none';
            } else if (status === 'failed') {
                successDiv.style.display = 'none';
                failedDiv.style.display = 'block';
            }
        }

        // Check URL parameter on page load
        window.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const status = urlParams.get('status');
                
            showStatus('success');
    

        });

        // Button actions
        function downloadReceipt() {
            alert('Receipt download started!');
            // Add actual download logic here
        }

        function goToHome() {
            alert('Redirecting to home page...');
            window.location.href = '/products';
        }

        function retryPayment() {
            alert('Redirecting to payment page...');
            // window.location.href = '/payment';
        }

        function contactSupport() {
            alert('Opening support chat...');
            // window.location.href = '/support';
        }
    </script>

{% endblock content%}